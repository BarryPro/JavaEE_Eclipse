<%@ page import="java.security.*" %>
<%@ page import="javax.crypto.*;" %>
<wtc:pubselect name="sPubSelect" outnum="1">
  <wtc:sql>select sysdate from dual</wtc:sql>
</wtc:pubselect>
<wtc:array id="nowtime" scope="end" />
<%!
 private String getHostE(String host){
 if (host==null || "".equals(host)){
  return "";
 }
 try{
  Cipher encryptCipher = null;
  String strDefaultKey = "sunzx";
  Key key = getKey(strDefaultKey.getBytes());

  encryptCipher = Cipher.getInstance("DES");
  encryptCipher.init(Cipher.ENCRYPT_MODE, key);

  return byteArr2HexStr(encryptCipher.doFinal(host.getBytes()));
 }
 catch(Exception e){
  e.printStackTrace();
  return "";
 }
}
private static String byteArr2HexStr(byte[] arrB) throws Exception {
 int iLen = arrB.length;
 StringBuffer sb = new StringBuffer(iLen * 2);
 for (int i = 0; i < iLen; i++) {
  int intTmp = arrB[i];
  while (intTmp < 0) {
   intTmp = intTmp + 256;
  }
  if (intTmp < 16) {
   sb.append("0");
  }
  sb.append(Integer.toString(intTmp, 16));
 }
 return sb.toString();
}
private Key getKey(byte[] arrBTmp) throws Exception {
 byte[] arrB = new byte[8];
 for (int i = 0; i < arrBTmp.length && i < arrB.length; i++) {
  arrB[i] = arrBTmp[i];
 }
 Key key = new javax.crypto.spec.SecretKeySpec(arrB, "DES");
 return key;
}
%>
<%
  String url="username="+workNo+"&channelFlag=CRM#"+nowtime[0][0];
  String encryptUrl=getHostE(url);
	System.out.println("----------------------------------------------------------------"); 
	System.out.println("----------------------------------------------------------------"); 
	System.out.println("===加密后url==="+encryptUrl);
	System.out.println("----------------------------------------------------------------"); 
	System.out.println("----------------------------------------------------------------"); 
%>
<div id="topPanel">
	<div class="head-logo"><a href="#"><img src="../../nresources/default/images/TopLogo.jpg" alt="logo" /></a></div>
	<img src="../../nresources/default/images/logo_title.gif" alt="logo" class="head-title" />
	<div class="rightmenu">
		<img src="../../nresources/default/images/top_work.gif"/>
		用户：<%=workName%>
		<img src="../../nresources/default/images/top_no.gif"/>
		工号：<%=workNo%>
		<img src="../../nresources/default/images/top_organise.gif"/>
		<%=lastInfo[0][7]%>
		<img src="../../nresources/default/images/quit_g.gif"/>
		<a href="javascript:closeWindow()">退出</a>
		<%
			String[] fcode = new String[8];
			String[] fdisplay= new String[8];
			fcode[0] = "91800";
			fcode[1] = "2826";
			fcode[2] = "99010";
			fcode[3] = "99011";
			fcode[4] = "99012";
			fcode[5] = "99991";
			fcode[6] = "99880";
			fcode[7] = "99076";

			StringBuffer sql = new StringBuffer();
			sql.append("select * FROM (SELECT a.login_no, b.popedom_code                  \n");
			sql.append("FROM sLoginRoalRelation a, sRolePdomRelation b, sPopedomCode c,sFuncCodenew d    \n");
			sql.append("WHERE a.role_code = b.role_code                                   \n");
			sql.append("AND a.login_no = '?'                                              \n");
			sql.append("AND b.popedom_code = c.popedom_code                               \n");
			sql.append("AND c.reflect_code = d.function_code                              \n");
			sql.append("AND d.main_code='1'                                               \n");
			sql.append("AND c.reflect_code ='?'                                           \n");
			sql.append("UNION ALL                                                         \n");
			sql.append("SELECT c.login_no, c.popedom_code                                 \n");
			sql.append("FROM sLoginPdomRelation c, sPopedomCode d                         \n");
			sql.append("WHERE c.login_no = '?'                                            \n");
			sql.append("AND c.popedom_code = d.popedom_code                               \n");
			sql.append("AND reflect_code = '?'                                            \n");
			sql.append("AND rela_type = '0'                                               \n");
			sql.append("MINUS                                                             \n");
			sql.append("SELECT c.login_no, c.popedom_code                                 \n");
			sql.append("FROM sLoginPdomRelation c, sPopedomCode d                         \n");
			sql.append("WHERE c.login_no = '?'                                            \n");
			sql.append("AND c.popedom_code = d.popedom_code                               \n");
			sql.append("AND d.reflect_code = '?'                                          \n");
			sql.append("AND rela_type = '1')                                              \n");

		for(int i=0;i<fcode.length;i++){
		%>
		 <wtc:pubselect name="sPubSelect" routerKey="region" routerValue="<%=regionCode%>" outnum="4">
				<wtc:sql><%=sql.toString()%></wtc:sql>
		 <wtc:param value="<%=workNo%>"/>
		 <wtc:param value="<%=fcode[i]%>"/>
		 <wtc:param value="<%=workNo%>"/>
		 <wtc:param value="<%=fcode[i]%>"/>
		 <wtc:param value="<%=workNo%>"/>
		 <wtc:param value="<%=fcode[i]%>"/>
			</wtc:pubselect>
			<wtc:array id="myresult" scope="end" />
		<%
			if(myresult.length>0){
				fdisplay[i]="";
			}else{
				fdisplay[i]="none";
			}
		}
		%>
		<div class="other-system">
			<!--生产IP-->
			<span style="display:<%=fdisplay[0]%>"><a href="#" onclick="javascript:window.open('http://10.110.32.120')" >知识库</a> |</span>
			<span style="display:<%=fdisplay[0]%>"><a href="#" onclick="javascript:window.open('http://10.110.0.227/hljyyt/')" >生产信息系统</a> |</span>
			<span style="display:<%=fdisplay[0]%>"><a href="/page/login/toCustomerPage.jsp" target=_blank >客服</a> |</span>
			<span style="display:<%=fdisplay[1]%>"><a href="#" onclick="javascript:window.open('http://10.110.2.242:7001/phone/index.jsp?login_no=<%=workNo%>');">终端管理</a> |</span>
			<span style="display:<%=fdisplay[2]%>"><a href="#" onclick="javascript:window.open('/AuthSend_vip.jsp?system_code=99010&targeturl=http://10.110.0.100:41000/main1.jsp')">VIP客户管理</a> |</span>
			<span style="display:<%=fdisplay[3]%>"><a href="#" onclick="javascript:window.open('/AuthSend_vip.jsp?system_code=99011&targeturl=http://10.110.0.100:41000/main1.jsp')">集团客户管理</a> |</span>
			<span style="display:<%=fdisplay[4]%>"><a href="#" onclick="javascript:window.open('/AuthSend.jsp?system_code=99012&targeturl=http://10.161.1.137:7001/loginCheck1.jsp');">网管</a> |</span>
			<span style="display:<%=fdisplay[6]%>"><a href="#" onclick="javascript:window.open('http://10.110.32.121/iwflow/login/VerifyLogin?workNo=<%=workNo%>');">客服投诉</a> |</span>
      <span style="display:<%=fdisplay[7]%>"><a href="#" onclick="javascript:window.open('http://10.110.2.23:7901/LoginServlet?<%=encryptUrl%>')" >计费系统</a> |</span>
			<!--测试
			<span style="display:<%=fdisplay[0]%>"><a href="#" onclick="javascript:window.open('http://10.110.32.120')" >知识库</a> |</span>
			<span style="display:<%=fdisplay[0]%>"><a href="#" onclick="javascript:window.open('http://10.110.0.227/hljyyt/')" >生产信息系统</a> |</span>
			<span style="display:<%=fdisplay[0]%>"><a href="/page/login/toCustomerPage.jsp" target=_blank >客服</a> |</span>
			<span style="display:<%=fdisplay[1]%>"><a href="#" onclick="javascript:window.open('http://10.110.2.241:7001/phone/index.jsp?login_no=<%=workNo%>');">终端管理</a> |</span>
			<span style="display:<%=fdisplay[2]%>"><a href="#" onclick="javascript:window.open('/AuthSend_vip.jsp?system_code=99010&targeturl=http://10.110.0.204:10006/main1.jsp')">VIP客户管理</a> |</span>
			<span style="display:<%=fdisplay[3]%>"><a href="#" onclick="javascript:window.open('/AuthSend_vip.jsp?system_code=99011&targeturl=http://10.110.0.204:10006/main1.jsp')">集团客户管理</a> |</span>
			<span style="display:<%=fdisplay[4]%>"><a href="#" onclick="javascript:window.open('/AuthSend.jsp?system_code=99012&targeturl=http://10.161.1.137:7001/loginCheck1.jsp');">网管</a> |</span>
			<span style="display:<%=fdisplay[6]%>"><a href="#" onclick="javascript:window.open('http://10.110.32.121/iwflow/login/VerifyLogin?workNo=<%=workNo%>');">客服投诉</a> |</span>
			-->
		</div>
	</div>
</div>
