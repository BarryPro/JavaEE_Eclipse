<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=gbk" />	
		<link href="/nresources/default/css/FormText.css" rel="stylesheet" type="text/css"></link>
    <link href="/nresources/default/css/font_color.css" rel="stylesheet" type="text/css"></link>
    <link href="/nresources/default/css/ValidatorStyle.css" rel="stylesheet" type="text/css"></link>
		<script src="/njs/extend/jquery/jquery123_pack.js" type="text/javascript"></script>  
		<script src="/njs/si/core_sitech_pack.js" type="text/javascript"></script>
		<script type="text/javascript" src="/njs/redialog/redialog.js"></script>
		<script language="JavaScript" src="/njs/si/validate_pack.js"></script>
	</head>
	<body>
		<div id='footer' style='height:25px;width:100%;'>
			<input style='height:25px;' id='input1' type='text' onkeyDown='if(event.keyCode==13) seach()'>
			<input class="b_foot" type='button' onclick='seach()' value='搜索'/>
			<input class="b_foot" type='button' onclick='clean()' value='清空'/>
			</div>
		<div>
      <iframe  name="myFrame4" frameborder="0" width="100%" height="300px" marginwidth="0" marginheight="0" scrolling="auto" src="callreasonlist.jsp"></iframe>	  
		</div>
		<div id='seldiv' style='float:left;width:100%;'>
			<select id='selectcontent' size='6' style='width:99%;height:100px' ondblclick='processsel()'>
			</select>
		</div>
		<div id='remdiv' style='float:right;width:30%;display:none;'>
			<textarea id='remark'  style='width:99%;height:100px'></textarea>
		</div>
		<div id='footer' style='float:left;height:25px;width:99%;'>
			<input class="b_foot" type='button' onclick='cleanselect()' value='全部清除'/>
			<input class="b_foot" type='button' onclick='inputremark()' value='备注'/>
			<input class="b_foot" type='button' onclick='save()' value='保存'/>
		</div>
		<script>
			var remarshowflag=0;
			function processsel()
			{
				var sel = document.getElementById('selectcontent');
				if(sel.selectedIndex >= 0 ){
					if(myFrame4.document.getElementById('chk'+sel.options[sel.selectedIndex].value) != null 
					   && myFrame4.document.getElementById('chk'+sel.options[sel.selectedIndex].value) != undefined)
					{
						myFrame4.document.getElementById('chk'+sel.options[sel.selectedIndex].value).checked=false;
					}
					sel.options.remove(sel.selectedIndex);
				}
				sel=null;
			}
			function seach()
			{
				if(document.getElementById('input1').value == null || document.getElementById('input1').value == '')
				{
					rdShowMessageDialog('请填写搜索描述',1);
					return;
				}
				window.open('callreasonserchlist.jsp?content='+document.getElementById('input1').value,'myFrame4');
			}
			function clean()
			{
				document.getElementById('input1').value="";
			}
			function inputremark()
			{
				if(remarshowflag==0)
				{
					document.getElementById('seldiv').style.width="70%";
					document.getElementById('remdiv').style.display="";
					remarshowflag=1;
				}else
				{
					document.getElementById('seldiv').style.width="100%";
					document.getElementById('remdiv').style.display="none";
					remarshowflag=0;
				}
			}
			//add wangyong 20090918 增加全部清除按钮
			function cleanselect()
			{
				var sel = document.getElementById('selectcontent').options;
				for(var i=0;i<sel.length;i++){
					if(myFrame4.document.getElementById('chk'+sel[i].value) != null 
					   && myFrame4.document.getElementById('chk'+sel[i].value) != undefined)
					{
						myFrame4.document.getElementById('chk'+sel[i].value).checked=false;
					}
				}
				sel.length=0;
				sel=null;
			}
			
			function save()
			{
				var contactId='';
				var contactMonth='';
				var strNodeId='';
				var strNodeName='';
				var remarkInfo='';
				var strPreNodeId='';
				var strPreNodeName='';
				var updateflag='';
				contactId = window.parent.document.getElementById('contactId').value;
				contactMonth = window.parent.document.getElementById('contactMonth').value;
				strPreNodeId = window.parent.document.getElementById('pre_node_Id').value;
				strPreNodeName = window.parent.document.getElementById('pre_node_Name').value;
				updateflag = window.parent.document.getElementById('updateflag').value;
				remarkInfo = document.getElementById('remark').value;
				
				var myselect=document.getElementById('selectcontent').options;
				
				if(updateflag == 0)
				{
					rdShowMessageDialog('超时，修改无效！',1);
					return;
				}
				/*updated by tangsong 20101018 去掉这个验证，以保证修改来电原因时可以全部删除
				//yanghy 20090916.add 
				if(myselect.length <= 0 ){
					rdShowMessageDialog('请至少选择一个来原因。',1);
					return;
				}
				*/
				if(myselect.length > 10)
				{
					rdShowMessageDialog('填写来电原因数量超过10个内容，不允许保存!',1);
					return;
				}
				
				for(var i=0;i<myselect.length;i++){
					strNodeId+=','+myselect[i].value;
					
					strNodeName+="<span id="+myselect[i].value+" ><"+myselect[i].text+"><br></span>";
	   		}
				if(contactId != null && contactId != '')
				{
					var mypacket = new AJAXPacket("/npage/callbosspage/k170/k172_modifyCallCause.jsp","aa");
					mypacket.data.add("strNodeId",strNodeId);
					mypacket.data.add("strNodeName",strNodeName);
					mypacket.data.add("remarkInfo",remarkInfo);
	  			mypacket.data.add("strContactId",contactId);
	  			mypacket.data.add("contactMonth",contactMonth);
	  			mypacket.data.add("strPreNodeId",strPreNodeId);
	  			mypacket.data.add("strPreNodeName",strPreNodeName);
  				core.ajax.sendPacket(mypacket,doProcessGetFlag,true);
					mypacket=null;
				}
			}
				function doProcessGetFlag(packet){
				   var str = packet.data.findValueByName("retCode");
				   returnFlag(str);
				}
				
				function returnFlag(str){
					if(str=="000000"){
				     /*add by fangyuan 090318 如果还在整理态中，保存成功后退出整理态--开始*/		
						 //exitWorkState();
						 /*add by fangyuan 090318 如果还在整理态中，保存成功后退出整理态--结束*/
						 }else{
						 	rdShowMessageDialog('填写来电原因失败',0);
						 }
						 //window.parent.opener.cCcommonTool.DebugLog("javascript *** insertCause end");
						//initTag=2;
						window.parent.close();
					}
				
				//by fangyuan 20090318 在整理态中，保存来电原因后，直接退出整理态
				
				function exitWorkState(){
				  var workNo=window.parent.opener.cCcommonTool.getWorkNo();
				  var current_CurState;
				  if(window.parent.opener.parPhone.QueryAgentStatusEx(workNo)==0){
				    current_CurState=window.parent.opener.parPhone.AgentInfoEx_CurState;
				  }
				if(current_CurState==6)
				  {
				  	 var el = window.parent.opener.document.getElementById("bn_status_first");
				      el.src="/nresources/default/images/ico_16/status_01.gif";
					 var ret = window.parent.opener.cCcommonTool.ExtenseAdjustment();
					 if(ret == 0){
					 		//恢复到空闲时的状态
					 		
							window.parent.opener.buttonType("K003");
							//lijin 090407 写整理态结束时间	
								var arr=new Array("'27'");
				 				var oprTypeAll=arr.join(",");
				 				var oprType="";
				 				var sign=0;
				 				window.parent.opener.recodeTime(oprTypeAll,oprType,sign,"");
						     //恢复状态栏中的座席状态,ref footpanel	
						    window.parent.opener.resetStatusTimer();	  	
							  window.parent.opener.clearAllAdjustTimer();
							  window.parent.opener.document.getElementById("extendTime").value="";
					    	window.parent.opener.document.getElementById("beforeTime").value="";
					 }
				  }
				}
			</script>
</body>
</html>