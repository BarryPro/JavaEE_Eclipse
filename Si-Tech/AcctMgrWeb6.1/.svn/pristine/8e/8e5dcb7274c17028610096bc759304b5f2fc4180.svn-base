<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE sqlMap      
    PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"      
    "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="bal_batchpay_mid">

  	<insert id="iBatchpayMid"  parameterClass="Map">
		INSERT INTO BAL_BATCHPAY_MID (
			BATCH_SN, ACT_TYPE, ACT_ID, ACT_UNIQ_CODE, ACT_SN,
			PHONE_NO, ID_NO, REGION_CODE, CONTRACT_NO, GRP_CON_NO, AUDIT_FLAG, TOTAL_DATE,
			OP_TYPE, PAY_TYPE, PAY_FEE, PAY_SN, PAY_FLAG, PAY_COMMENT, SMS_FLAG, LOGIN_NO,
			OP_TIME, REMARK, BEGIN_TIME, END_TIME, FOREIGN_SN, OP_CODE, YEAR_MONTH, USER_PHONE
		)
		VALUES(
			#BATCH_SN#, #ACT_ID#, #ACT_ID#, 0, #ACT_SN#,
			#PHONE_NO#, #ID_NO#, #REGION_CODE#, #CONTRACT_NO#, 0, #AUDIT_FLAG#, #TOTAL_DATE#,
			#OP_TYPE#, #PAY_TYPE#, #PAY_FEE#, #PAY_SN#, #PAY_FLAG#, #PAY_COMMENT#, #SMS_FLAG#, #LOGIN_NO#,
			SYSDATE, #REMARK#,TO_DATE(#BEGIN_TIME#,'YYYYMMDDHH24MISS'), TO_DATE(#END_TIME#,'YYYYMMDDHH24MISS')
			, #FOREIGN_SN#,#OP_CODE#, #YEAR_MONTH#, #USER_PHONE#
		)
	</insert>

	<update id="uAuditByActsn"  parameterClass="Map">
		UPDATE BAL_BATCHPAY_MID SET AUDIT_FLAG = #AUDIT_FLAG# 
		WHERE ACT_SN = #ACT_SN# and AUDIT_FLAG = #OLD_AUDIT_FLAG#
	</update>

  <select id="qBatchPayMid"  parameterClass="Map" resultClass="java.util.HashMap">
    SELECT A.PAY_TYPE PAY_TYPE,
			NVL(A.PAY_FEE,0) PAY_FEE,
			B.PAY_TYPE_NAME PAY_TYPE_NAME,  
			TO_CHAR(A.OP_TIME,'YYYYMMDD HH24:MI:SS') OP_TIME,
      		TO_CHAR(A.BEGIN_TIME,'YYYYMMDD HH24:MI:SS') BEGIN_TIME, 
      		TO_CHAR(A.END_TIME,'YYYYMMDD HH24:MI:SS') END_TIME,
      		PAY_ATTR,
      		PHONE_NO,AUDIT_FLAG,NVL(ACT_SN,0) ACT_SN,
      		A.REMARK REMARK
	FROM BAL_BATCHPAY_MID A, BAL_BOOKTYPE_DICT B  
	WHERE A.PAY_TYPE=B.PAY_TYPE 
		  AND TO_CHAR(OP_TIME, 'YYYYMM')=#OP_YM#
     <dynamic prepend="">
     	<isNotEmpty prepend="AND" property="CONTRACT_NO">
		   CONTRACT_NO=#CONTRACT_NO#
    	</isNotEmpty>
    	<isNotEmpty prepend="AND" property="PAY_SN">
    		A.PAY_SN = #PAY_SN#
    	</isNotEmpty>
    	<isNotEmpty prepend="AND" property="FOREIGN_SN">
    		A.FOREIGN_SN = #FOREIGN_SN#
    	</isNotEmpty>
    	<isNotEmpty prepend="AND" property="ACT_SN">
    		A.ACT_SN = #ACT_SN#
    	</isNotEmpty>
    	<isNotEmpty prepend="AND" property="OP_DATE">
		   TO_CHAR(OP_TIME, 'YYYYMMDD')=#OP_DATE#
    	</isNotEmpty>
    </dynamic>
    ORDER BY A.OP_TIME DESC 
  </select>

</sqlMap>

