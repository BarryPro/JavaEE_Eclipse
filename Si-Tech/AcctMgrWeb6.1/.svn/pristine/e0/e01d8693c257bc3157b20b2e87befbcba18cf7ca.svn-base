<?xml version="1.0" encoding="UTF-8" ?>

<!DOCTYPE sqlMap
        PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"
        "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="bal_groupcharge_err">
	<typeAlias alias="GroupChargeEntity" type="com.sitech.acctmgr.atom.domains.pay.GroupChargeEntity"/>

	<insert id="iGrpErrByRecd"  parameterClass="Map">
       	INSERT INTO BAL_GROUPCHARGE_ERR (TOTAL_DATE,OP_CODE,PHONE_NO,CONTRACT_NO
        	,LOGIN_NO,IMPORT_TIME,GROUP_CONTRACT_NO,GROUP_PRODUCT_NAME,FILE_NAME,IMPORT_BATCH_SN,PAY_MONEY
        	,TRANS_CODE,TRANS_LOGIN,ERR_TIME,ERR_MSG)
         SELECT TOTAL_DATE,OP_CODE,PHONE_NO,CONTRACT_NO
        	,LOGIN_NO,IMPORT_TIME,GROUP_CONTRACT_NO,GROUP_PRODUCT_NAME,FILE_NAME,IMPORT_BATCH_SN,PAY_MONEY
        	,#TRANS_CODE#,#TRANS_LOGIN#,SYSDATE,#ERR_MSG#
        FROM BAL_GROUPCHARGE_RECD 
        WHERE PHONE_NO = #PHONE_NO#
        AND IMPORT_BATCH_SN = #IMPORT_BATCH_SN#
  </insert>
  
  	<select id="qryErrList" parameterClass="Map" resultClass="GroupChargeEntity">
		SELECT A.GROUP_CONTRACT_NO groupContractNo,GROUP_PRODUCT_NAME groupProductName
			,TO_CHAR(A.PHONE_NO) phoneNo,TO_CHAR(ERR_TIME ,'YYYYMMDD HH24:MI:SS') errTime,TRIM(A.ERR_MSG) errMsg
		FROM BAL_GROUPCHARGE_ERR A ,AC_CONTRACT_INFO B
		WHERE A.GROUP_CONTRACT_NO =#GROUP_CONTRACT_NO#
		AND A.GROUP_CONTRACT_NO = B.CONTRACT_NO
		AND TO_CHAR(ERR_TIME ,'YYYYMMDD') <![CDATA[ >= ]]> #BEGIN_TIME# 
		AND TO_CHAR(ERR_TIME,'YYYYMMDD') <![CDATA[ <=]]>  #END_TIME# 
		ORDER BY A.IMPORT_TIME DESC
   </select>
	    
</sqlMap>
