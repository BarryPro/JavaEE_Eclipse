package com.sitech.acctmgr.app.test;

import java.util.Date;

import org.apache.commons.pool2.KeyedObjectPool;
import org.apache.commons.pool2.impl.GenericKeyedObjectPool;


import com.sitech.crmpd.idmm2.client.MessageContext;
import com.sitech.crmpd.idmm2.client.api.Message;
import com.sitech.crmpd.idmm2.client.api.PropertyOption;
import com.sitech.crmpd.idmm2.client.pool.PooledMessageContextFactory;

public class Idmm2SenderTest {

	public static void main(String[] argv) {
		
		System.out.println("---------开始发送--------"+new Date());

			
/*
#KaiFa
ADDR=10.163.106.122:1234
#JiCheng
#ADDR=10.163.106.160:1234,10.163.106.161:1234,10.163.106.162:1234
#ShengChan
#ADDR=10.162.200.211:4321,10.162.200.212:4321,10.162.200.213:4321,10.162.200.220:4321,10.162.200.221:4321
*/
		String client = "Pub101";
		String addr = "10.149.85.32:2185,10.149.85.33:2185,10.149.85.34:2185";
		final KeyedObjectPool<String, MessageContext> pool = new GenericKeyedObjectPool<String, MessageContext>(
				new PooledMessageContextFactory(addr, 6000));
	//for (int i = 0; i < 100; i++)
		try {
			final MessageContext context = pool.borrowObject(client);
			String content = "{\"ROOT\":{\"HEADER\":{\"DB_ID\":\"A2\",\"ROUTING\":{\"ROUTE_KEY\":\"11\",\"ROUTE_VALUE\":\"220801000000008049\"},\"KEEP_LIVE\":\"10.161.251.76\",\"TRACE_ID\":\"11*20160905143145*8008*hbgj11*700656\",\"CHANNEL_ID\":\"11\",\"PARENT_CALL_ID\":\"B9AFD43CA92A74CB9811C9C0A0DA48F4\",\"POOL_ID\":\"1\"},\"BODY\":{\"OPR_INFO\":{\"OP_CODE\":\"1055\",\"OP_TIME\":\"20160905144854\",\"LOGIN_NO\":\"hbgj11\",\"ACTION_ID\":\"10550\",\"ORDER_LINE_ID\":\"L16090500000076\"},\"BUSI_INFO\":[{\"PAY_PATH\":\"11\",\"PHONE_NO\":\"10710086510\",\"ADDFEE_SUM\":0,\"PAY_FEE\":\"-30000\",\"BUSI_CODE\":\"ASYTFCL\",\"PAY_TYPE\":\"0\",\"SM_FLAG\":\"1\",\"IS_PRINT\":\"X\",\"NOTE\":\"销户退可退套餐费\",\"BACKFEE_SUM\":30000,\"PROD_PRCID\":\"22CAZ15026\",\"PAY_METHOD\":\"0\",\"CONTRACT_NO\":\"220801100000145082\",\"BACK_TYPE\":\"3\"},{\"PAY_PATH\":\"11\",\"BUSI_CODE\":\"XHTYC\",\"RECEIVE_FEE_TYPE\":\"1\",\"NOTE\":\"销户退费\",\"PAY_STATE\":\"1\",\"IF_ONNET\":\"3\",\"ID_NO\":\"220801000000008049\",\"PAY_MODE\":\"0\",\"PAY_FEE\":\"0\",\"PHONE_NO\":\"10710086510\",\"PAY_TYPE\":\"0\",\"IS_PRINT\":\"X\",\"PAY_METHOD\":\"0\",\"CONTRACT_NO\":\"220801100000145082\",\"PAY_MONEY\":\"0\"}],\"TABLES\":[{\"TABLENAME\":\"AC_CONTRACTDEAD_INFO\",\"DATARECORDS\":[{\"COLS\":{\"OP_CODE\":\"1055\",\"CONTRACT_NAME\":\"++sNfT6tfj\",\"GROUP_ID\":\"1599\",\"CONTRACTATT_TYPE\":\"13\",\"STATUS_TIME\":\"20160229100201\",\"REPRESENT_PHONE\":\"无\",\"CONTRACT_NAME_ENCRYPT\":\"\",\"ACCOUNT_LIMIT\":\"A\",\"ACCOUNT_TYPE\":\"0\",\"OP_TIME\":\"20160905144455\",\"LOGIN_ACCEPT\":10000001137277,\"CUST_ID\":220871100000165786,\"LOGIN_NO\":\"hbgj11\",\"FINISH_FLAG\":\"N\",\"CONTRACT_PASSWD\":\"4bfa68de195a80e9f0G\",\"PAY_CODE\":\"0\",\"CONTRACT_NO\":220801100000145082,\"STATUS_CODE\":1},\"OP\":\"I\"}]},{\"TABLENAME\":\"AC_CONTRACT_INFO\",\"DATARECORDS\":[{\"COLS\":{\"CONTRACT_NO\":220801100000145082},\"OP\":\"D\"}]},{\"TABLENAME\":\"CS_CONUSERREL_INFO\",\"DATARECORDS\":[{\"COLS\":{\"SERV_ACCT_ID\":100000973164},\"OP\":\"D\"}]},{\"TABLENAME\":\"CS_CRMTOBOSSSTATE_INFO\",\"DATARECORDS\":[{\"COLS\":{\"ID_NO\":220801000000008049},\"OP\":\"D\"}]},{\"TABLENAME\":\"CS_USERDETAILDEAD_INFO\",\"DATARECORDS\":[{\"COLS\":{\"OP_CODE\":\"1002\",\"CARD_TYPE\":1,\"OP_NOTE\":\"铁通融合数据迁移\",\"USER_PASSWD\":\"cc9a50675081c6882e8e4999abc4dfaaz2f\",\"LMT_ADJUST_TYPE\":\"10\",\"SYSTEM_NOTE\":\"铁通融合数据迁移\",\"RUN_TIME\":\"20160905144455\",\"PASSWD_TYPE\":\"0\",\"VIP_CARD_NO\":\"1\",\"BAK1\":\"\",\"BAK2\":\"\",\"USER_GRADE_CODE\":\"03\",\"OWED_FLAG\":\"Y\",\"OP_TIME\":\"20160905144455\",\"ID_NO\":220801000000008049,\"LOGIN_ACCEPT\":-1,\"STOP_FLAG\":\"Y\",\"VIP_CREATE_TYPE\":0,\"OLD_RUN\":\"A\",\"QUERY_CDRFLAG\":\"Y\",\"LOGIN_NO\":\"10000\",\"RUN_CODE\":\"a\"},\"OP\":\"I\"}]},{\"TABLENAME\":\"CS_USERDETAIL_INFO\",\"DATARECORDS\":[{\"COLS\":{\"ID_NO\":220801000000008049},\"OP\":\"D\"}]},{\"TABLENAME\":\"UR_BILLDAYDEAD_INFO\",\"DATARECORDS\":[{\"COLS\":{\"OP_CODE\":\"1055\",\"ID_NO\":220801000000008049,\"OP_TIME\":\"20160905144455\",\"LOGIN_ACCEPT\":10000001137277,\"EXP_DATE\":\"20500101000000\",\"PHONE_NO\":\"10710086510\",\"EXTEND_INFO1\":\"\",\"EXTEND_INFO2\":\"\",\"MASTER_SERV_ID\":\"1002\",\"LOGIN_NO\":\"hbgj11\",\"DUR_FLAG\":\"0\",\"EFF_DATE\":\"20160229100201\",\"BILL_DAY\":\"1\",\"CONTRACT_NO\":220801100000145082},\"OP\":\"I\"}]},{\"TABLENAME\":\"UR_BILLDAY_INFO\",\"DATARECORDS\":[{\"COLS\":{\"ID_NO\":220801000000008049,\"EFF_DATE\":\"20160229100201\",\"BILL_DAY\":\"1\",\"CONTRACT_NO\":220801100000145082},\"OP\":\"D\"}]},{\"TABLENAME\":\"UR_SERVADDNUM_INFO\",\"DATARECORDS\":[{\"COLS\":{\"ID_NO\":220801000000008049,\"ADD_NBR_TYPE\":\"02\"},\"OP\":\"D\"},{\"COLS\":{\"ID_NO\":220801000000008049,\"ADD_NBR_TYPE\":\"01\"},\"OP\":\"D\"}]},{\"TABLENAME\":\"UR_USERBILLMODE_INFO\",\"DATARECORDS\":[{\"COLS\":{\"OP_CODE\":\"1055 \",\"ID_NO\":220801000000008049,\"OP_TIME\":\"20160905144455\",\"EXP_DATE\":\"20160905144455\",\"LOGIN_ACCEPT\":10000001137277,\"BILLING_MODE\":\"B\",\"BILL_MODE_ORDER\":10710086510,\"LOGIN_NO\":\"hbgj11\",\"FINISH_FLAG\":\"N\",\"EFF_DATE\":\"20160229100201\"},\"PK\":[\"ID_NO\",\"EFF_DATE\",\"BILLING_MODE\",\"SVC_ID\"],\"OP\":\"X\"}]},{\"TABLENAME\":\"UR_USERBRAND_REL\",\"DATARECORDS\":[{\"COLS\":{\"OP_CODE\":\"1055 \",\"ID_NO\":220801000000008049,\"OP_TIME\":\"20160905144455\",\"EXP_DATE\":\"20160905144455\",\"LOGIN_ACCEPT\":10000001137277,\"BRAND_ID\":\"2210kd\",\"LOGIN_NO\":\"hbgj11\",\"FINISH_FLAG\":\"N\",\"EFF_DATE\":\"20160229100201\"},\"PK\":[\"ID_NO\",\"BRAND_ID\",\"EFF_DATE\"],\"OP\":\"X\"}]},{\"TABLENAME\":\"UR_USERDEAD_INFO\",\"DATARECORDS\":[{\"COLS\":{\"OP_CODE\":\"1055\",\"BAK_FIELD\":\"0\",\"CMD_RIGHT\":0,\"ACCESS_TYPE\":\"000\",\"LOGIN_ACCEPT\":10000001137277,\"COMPLETED_DATE\":\"20500101000000\",\"PHONE_NO\":\"10710086510\",\"CUST_ID\":220871100000165786,\"CREATE_LOGIN\":\"system\",\"BILL_END_TIME\":\"20500101000000\",\"MASTER_SERV_ID\":\"1002\",\"FIRST_USEDATE\":\"20500101000000\",\"BILL_START_TIME\":\"20500101000000\",\"PHOTO_FLAG\":\"N\",\"BILL_TYPE\":12,\"ASSURE_FLAG\":\"0\",\"GROUP_ID\":\"1599\",\"BRAND_CREATE_TYPE\":\"1\",\"BILLING_CYCLE_TYPE_ID\":0,\"BAK_FIELD1\":\"\",\"RENT_DATE\":\"20500101000000\",\"GROUP_FLAG\":\"N\",\"SERVICE_GROUP\":\"1599\",\"OP_TIME\":\"20160905144455\",\"OWNER_TYPE\":1,\"ID_NO\":220801000000008049,\"OWNED_CHNL_ID\":\"1599\",\"EMP_GROUP\":\"\",\"EMP_ID\":\"\",\"LOGIN_NO\":\"hbgj11\",\"STOP_RENT_DATE\":\"20500101000000\",\"OPEN_TIME\":\"20160229100201\",\"FINISH_FLAG\":\"N\",\"CREATE_DATE\":\"20160229100201\",\"CONTRACT_NO\":220801100000145082},\"OP\":\"I\"}]},{\"TABLENAME\":\"UR_USERPRC_INFO\",\"DATARECORDS\":[{\"COLS\":{\"OP_CODE\":\"1055\",\"ORDER_DATE\":\"20160322000000\",\"STATE\":\"X\",\"SERV_ORDER_ID\":\"L16090500000076\",\"REMARK\":\"铁通融合数据迁移\",\"STATE_DATE\":\"20160905144455\",\"PRODPRCINS_ID\":100001025698,\"CANCLE_SOURCE\":\"\",\"EXP_DATE\":\"20160905144455\",\"PRICING_ID\":0,\"LOGIN_ACCEPT\":10000001137277,\"PROD_ID\":\"22PAZ1006177\",\"PROD_PRCID\":\"22CAZ15026\",\"GROUP_ID\":0,\"RELPRCINS_ID\":0,\"PARPRC_ID\":\"0\",\"DEVELOP_LOGIN\":\"\",\"EFF_DATE\":\"20160322000000\",\"ID_NO\":220801000000008049,\"PROD_MAIN_FLAG\":\"0\",\"OP_TIME\":\"20160905144455\",\"TEAM_ID\":0,\"DATA_OPSOURCE\":\"\",\"LOGIN_NO\":\"hbgj11\",\"FINISH_FLAG\":\"N\",\"ORDER_SOURCE\":\"11\",\"ORDER_LOGINNO\":\"\",\"TRANPRCINS_ID\":0},\"PK\":[\"PRODPRCINS_ID\"],\"OP\":\"X\"}]},{\"TABLENAME\":\"UR_USERSERVLOC_INFO\",\"DATARECORDS\":[{\"COLS\":{\"ID_NO\":220801000000008049},\"OP\":\"D\"}]},{\"TABLENAME\":\"UR_USERSVCATTRTRACE_INFO\",\"DATARECORDS\":[{\"COLS\":{\"OP_CODE\":\"1055\",\"SERV_ORDER_ID\":\"L16090500000076\",\"EFF_DATE\":\"20160322000000\",\"GRP_NO\":\"0\",\"SVCINS_ID\":100001025698,\"OP_TIME\":\"20160905144455\",\"ID_NO\":220801000000008049,\"ATTR_VALUE\":\"4\",\"LOGIN_ACCEPT\":10000001137277,\"EXP_DATE\":\"20160905144455\",\"ATTR_NO\":\"0\",\"LOGIN_NO\":\"hbgj11\",\"FINISH_FLAG\":\"N\",\"ATTR_ID\":\"22B00001\",\"SVC_ID\":\"BSM0000002\"},\"PK\":[\"SVCINS_ID\",\"ATTR_NO\",\"ATTR_ID\",\"EFF_DATE\"],\"OP\":\"X\"},{\"COLS\":{\"OP_CODE\":\"1055\",\"SERV_ORDER_ID\":\"L16090500000076\",\"EFF_DATE\":\"20160322000000\",\"GRP_NO\":\"0\",\"SVCINS_ID\":100001025698,\"OP_TIME\":\"20160905144455\",\"ID_NO\":220801000000008049,\"ATTR_VALUE\":\"tietong\",\"LOGIN_ACCEPT\":10000001137277,\"EXP_DATE\":\"20160905144455\",\"ATTR_NO\":\"0\",\"LOGIN_NO\":\"hbgj11\",\"FINISH_FLAG\":\"N\",\"ATTR_ID\":\"22B00006\",\"SVC_ID\":\"BSM0000002\"},\"PK\":[\"SVCINS_ID\",\"ATTR_NO\",\"ATTR_ID\",\"EFF_DATE\"],\"OP\":\"X\"},{\"COLS\":{\"OP_CODE\":\"1055\",\"SERV_ORDER_ID\":\"L16090500000076\",\"EFF_DATE\":\"20160322000000\",\"GRP_NO\":\"0\",\"SVCINS_ID\":100001025698,\"OP_TIME\":\"20160905144455\",\"ID_NO\":220801000000008049,\"ATTR_VALUE\":\"XDSL\",\"LOGIN_ACCEPT\":10000001137277,\"EXP_DATE\":\"20160905144455\",\"ATTR_NO\":\"0\",\"LOGIN_NO\":\"hbgj11\",\"FINISH_FLAG\":\"N\",\"ATTR_ID\":\"22B00456\",\"SVC_ID\":\"BSM0000002\"},\"PK\":[\"SVCINS_ID\",\"ATTR_NO\",\"ATTR_ID\",\"EFF_DATE\"],\"OP\":\"X\"},{\"COLS\":{\"OP_CODE\":\"1055\",\"SERV_ORDER_ID\":\"L16090500000076\",\"EFF_DATE\":\"20160322000000\",\"GRP_NO\":\"0\",\"SVCINS_ID\":100001025698,\"OP_TIME\":\"20160905144455\",\"ID_NO\":220801000000008049,\"ATTR_VALUE\":\"13804383656\",\"LOGIN_ACCEPT\":10000001137277,\"EXP_DATE\":\"20160905144455\",\"ATTR_NO\":\"0\",\"LOGIN_NO\":\"hbgj11\",\"FINISH_FLAG\":\"N\",\"ATTR_ID\":\"22B00008\",\"SVC_ID\":\"BSM0000002\"},\"PK\":[\"SVCINS_ID\",\"ATTR_NO\",\"ATTR_ID\",\"EFF_DATE\"],\"OP\":\"X\"},{\"COLS\":{\"OP_CODE\":\"1055\",\"SERV_ORDER_ID\":\"L16090500000076\",\"EFF_DATE\":\"20160322000000\",\"GRP_NO\":\"0\",\"SVCINS_ID\":100001025698,\"OP_TIME\":\"20160905144455\",\"ID_NO\":220801000000008049,\"ATTR_VALUE\":\"白雨足\",\"LOGIN_ACCEPT\":10000001137277,\"EXP_DATE\":\"20160905144455\",\"ATTR_NO\":\"0\",\"LOGIN_NO\":\"hbgj11\",\"FINISH_FLAG\":\"N\",\"ATTR_ID\":\"22B00007\",\"SVC_ID\":\"BSM0000002\"},\"PK\":[\"SVCINS_ID\",\"ATTR_NO\",\"ATTR_ID\",\"EFF_DATE\"],\"OP\":\"X\"}]},{\"TABLENAME\":\"UR_USERSVCTRACE_INFO\",\"DATARECORDS\":[{\"COLS\":{\"OP_CODE\":\"1055\",\"STATE\":\"1\",\"SERV_ORDER_ID\":\"L16090500000076\",\"STATE_DATE\":\"20160905144455\",\"PRODPRCINS_ID\":100001025698,\"EFF_DATE\":\"20160322000000\",\"SVCINS_ID\":100001025698,\"ID_NO\":220801000000008049,\"OP_TIME\":\"20160905144455\",\"EXP_DATE\":\"20160905144455\",\"LOGIN_ACCEPT\":10000001137277,\"LOGIN_NO\":\"hbgj11\",\"FINISH_FLAG\":\"N\",\"SVC_TYPE\":\"M\",\"SVC_ID\":\"BSM0000002\"},\"PK\":[\"SVCINS_ID\"],\"OP\":\"X\"}]},{\"TABLENAME\":\"UR_USER_INFO\",\"DATARECORDS\":[{\"COLS\":{\"ID_NO\":220801000000008049},\"OP\":\"D\"}]}],\"ABCTABLES\":[{\"TABLENAME\":\"UR_SERVICENO_INFO\",\"DATARECORDS\":[{\"COLS\":{\"ID_NO\":220801000000008049,\"SERVICE_NO\":\"080011911700\",\"SERVICE_TYPE\":\"02\"},\"OP\":\"D\"},{\"COLS\":{\"ID_NO\":220801000000008049,\"SERVICE_NO\":\"10710086510\",\"SERVICE_TYPE\":\"01\"},\"OP\":\"D\"}]}]}}}"; 
			System.out.println("content="+content);
			final Message message = Message.create(content);// 如果是对象，需要先序列化，在消费者侧反序列化
			message.setProperty(PropertyOption.COMPRESS, true);// 是否压缩
			message.setProperty(PropertyOption.GROUP, "13999999994");// id_no或者
			message.setProperty(PropertyOption.PRIORITY, 1000);// 1-1000
			final PropertyOption<String> MESSAGE_PART = PropertyOption.valueOf("msg_part");
			message.setProperty(MESSAGE_PART,  "01");
			final String id = context.send("T101DataSyn", message);//T109DataRpt
			System.out.println(id);
			context.commit(id);

			pool.returnObject(client, context);
			
			System.out.println("---------结束发送--------"+new Date());
		} catch (final Exception e) {
			e.printStackTrace();
		}
		pool.close();
	}

}
